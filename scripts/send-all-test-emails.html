<!DOCTYPE html>
<html>
<head>
    <title>Send All Test Emails</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
        }
        button {
            background: #7ef4c2;
            color: #0e1a2b;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
        }
        button:hover {
            background: #6ee4b2;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin: 20px 0;
            padding: 12px;
            border-radius: 8px;
            background: #f5f5f5;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>Send All Test Emails</h1>
    <p>This will send 16 test emails to krish@themindmaker.ai for all CTA paths.</p>
    
    <button id="sendAll">Send All Test Emails</button>
    <button id="sendOne">Send One Test Email</button>
    
    <div id="status"></div>
    <div id="results"></div>

    <script type="module">
        // Get Supabase URL and key from window (set by main app)
        // Or use environment variables if available
        const SUPABASE_URL = window.SUPABASE_URL || import.meta.env.VITE_SUPABASE_URL || "";
        const SUPABASE_ANON_KEY = window.SUPABASE_ANON_KEY || import.meta.env.VITE_SUPABASE_ANON_KEY || "";

        const testLeads = [
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "CEO",
                selectedProgram: "initial-consult",
                description: "Main Page - Book Your Initial Consult (Bottom)"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "CEO",
                selectedProgram: "initial-consult",
                description: "Main Page - Book Session (Top Nav)"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "CTO",
                selectedProgram: "build",
                commitmentLevel: "1hr",
                audienceType: "individual",
                pathType: "build",
                description: "Product Ladder - Individual → Build → 1 Hour"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "VP Engineering",
                selectedProgram: "orchestrate",
                commitmentLevel: "4wk",
                audienceType: "individual",
                pathType: "orchestrate",
                description: "Product Ladder - Individual → Orchestrate → 4 Week"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "Chief Product Officer",
                selectedProgram: "build",
                commitmentLevel: "90d",
                audienceType: "individual",
                pathType: "build",
                description: "Product Ladder - Individual → Build → 90 Day"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "COO",
                selectedProgram: "team",
                commitmentLevel: "3hr",
                audienceType: "team",
                description: "Product Ladder - Team → 3 Hour"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "CMO",
                selectedProgram: "team",
                commitmentLevel: "4wk",
                audienceType: "team",
                description: "Product Ladder - Team → 4 Week"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "CRO",
                selectedProgram: "team",
                commitmentLevel: "90d",
                audienceType: "team",
                description: "Product Ladder - Team → 90 Day"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "Executive Director",
                selectedProgram: "build",
                commitmentLevel: "1hr",
                audienceType: "individual",
                pathType: "build",
                description: "Individual Page - Sticky CTA (build, 1hr)"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "General Manager",
                selectedProgram: "orchestrate",
                commitmentLevel: "4wk",
                audienceType: "individual",
                pathType: "orchestrate",
                description: "Individual Page - Nav Book Session (orchestrate, 4wk)"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "VP Operations",
                selectedProgram: "team",
                commitmentLevel: "4wk",
                audienceType: "team",
                description: "Team Page - Sticky CTA (4wk)"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "Chief Strategy Officer",
                selectedProgram: "team",
                commitmentLevel: "90d",
                audienceType: "team",
                description: "Team Page - Nav Book Session (90d)"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "Founder",
                selectedProgram: "consultation-booking",
                description: "ConsultationBooking Component"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "Board Member",
                selectedProgram: "builder-assessment",
                description: "Builder Assessment CTA"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "Advisor",
                selectedProgram: "friction-map",
                description: "Friction Map Builder CTA"
            },
            {
                name: "Krish Raja",
                email: "krish@tesla.com",
                jobTitle: "Investor",
                selectedProgram: "portfolio-builder",
                description: "Portfolio Builder CTA"
            }
        ];

        async function sendTestEmail(lead) {
            try {
                const response = await fetch(`${SUPABASE_URL}/functions/v1/send-lead-email`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${SUPABASE_ANON_KEY}`,
                        "apikey": SUPABASE_ANON_KEY,
                    },
                    body: JSON.stringify({
                        name: lead.name,
                        email: lead.email,
                        jobTitle: lead.jobTitle,
                        selectedProgram: lead.selectedProgram,
                        commitmentLevel: lead.commitmentLevel,
                        audienceType: lead.audienceType,
                        pathType: lead.pathType,
                        sessionData: {
                            pagesVisited: ["/", "/#products"],
                            timeOnSite: 180,
                            scrollDepth: 70,
                        }
                    }),
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                return { success: true, lead, data };
            } catch (error) {
                return { success: false, lead, error: error.message };
            }
        }

        document.getElementById('sendOne').addEventListener('click', async () => {
            const button = document.getElementById('sendOne');
            button.disabled = true;
            const status = document.getElementById('status');
            status.innerHTML = '<div class="status">Sending test email...</div>';
            
            const result = await sendTestEmail(testLeads[0]);
            
            if (result.success) {
                status.innerHTML = `<div class="status success">✅ Email sent: ${result.lead.description}</div>`;
            } else {
                status.innerHTML = `<div class="status error">❌ Error: ${result.error}</div>`;
            }
            
            button.disabled = false;
        });

        document.getElementById('sendAll').addEventListener('click', async () => {
            const button = document.getElementById('sendAll');
            button.disabled = true;
            const status = document.getElementById('status');
            const results = document.getElementById('results');
            
            status.innerHTML = '<div class="status">Sending all test emails...</div>';
            results.innerHTML = '';
            
            let successCount = 0;
            let errorCount = 0;
            
            for (let i = 0; i < testLeads.length; i++) {
                const lead = testLeads[i];
                status.innerHTML = `<div class="status">Sending ${i + 1}/${testLeads.length}: ${lead.description}</div>`;
                
                const result = await sendTestEmail(lead);
                
                if (result.success) {
                    successCount++;
                    results.innerHTML += `<div class="status success">✅ [${i + 1}] ${lead.description}</div>`;
                } else {
                    errorCount++;
                    results.innerHTML += `<div class="status error">❌ [${i + 1}] ${lead.description}: ${result.error}</div>`;
                }
                
                // Small delay between emails
                if (i < testLeads.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
            
            status.innerHTML = `<div class="status ${errorCount === 0 ? 'success' : 'error'}">Complete: ${successCount} succeeded, ${errorCount} failed</div>`;
            button.disabled = false;
        });
    </script>
</body>
</html>
